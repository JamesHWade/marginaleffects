---
title: "S Values"
---

```{r, include = FALSE}
options(width = 1000)
## this vignette is in .Rbuildignore because lme4 is not available on old CRAN
## test machines.

knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 9,
  fig.asp = .4,
  out.width = "100%",
  warning = FALSE,
  message = FALSE,
  comment = "#>"
)
```

Since version 0.12.1, `marginaleffects` reports _S_ values for all the quantities it computes [@RafGre2020].

The _S_ value --- "Shannon transform" or "binary surprisal value" --- is a cognitive tool to help analysts make sense of p values. Its purpose is to compare a p value to the probability of an outcome in a familiar game of chance.

Consider this situation: We toss a coin 4 times and see if we can reject the null hypothesis that the coin is fair. If the null is true (fair coin), the probability of drawing *Heads* on any single toss is $\frac{1}{2}$. The probability of observing 4 *Heads* in a row is $\left (\frac{1}{2} \right )^4=\frac{1}{16}=0.0625$. This probability (0.0625) characterizes the "surprise" caused by observing 4 straight heads in a world where the null holds, that is, where the coin is fair.

Now consider a different exercise: We estimate a model and use `marginaleffects::hypotheses` to test if two of the estimated coefficients are equal:

```{r}
library(marginaleffects)
mod <- lm(mpg ~ factor(cyl), mtcars)
hyp <- hypotheses(mod, "`factor(cyl)6` = `factor(cyl)8`")
hyp
```

The difference between those two coefficients is `r sprintf("%.2f", hyp$estimate)`, and the associated p value is `r hyp$p.value`. Again, the p value can be interpreted as a measure of the surprise that would be generated by the data if the null were true (i.e., if the two coefficients were in fact equal).

How many consecutive *Heads* would I need to get to be as surprised as I am by this test of equality. To answer this, we must solve for $s$ in this equation: $p=\left (\frac{1}{2} \right )^s$. The solution is the negative $log_2$ of p:

```{r}
#| include: false
attr(hyp$p.value, "label") <- attr(hyp$p.value, "jacobian") <- NULL
```
```{r}
-log2(hyp$p.value)
```

Indeed, the probability of throwing 9 straight *Heads* with a fair coin is $\left (\frac{1}{2} \right )^9=`r .5^9`$, which is very close to the p value we observed in the test of coefficient equality. Comparing our p value to the outcome of such a familiar game of chance gives us a nice intuitive interpretation:

> If the `factor(cyl)6` and `factor(cyl)8` coefficients were truly equal, finding a difference equal to or greater than $|`r sprintf("%.2f", hyp$estimate)`|$ would be as surprising as tossing 9 straight *Heads* with a fair coin.


