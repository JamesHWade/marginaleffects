---
title: "Marginal Means" 
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Marginal Means}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 6,
  fig.asp = .4,
  warning = FALSE,
  message = FALSE,
  comment = "#>"
)

library(marginaleffects)
library(patchwork)
library(ggplot2)

theme_set(theme_minimal())
```



```{r}
mod <- lm(mpg ~ hp + factor(cyl) + factor(am) + factor(gear), mtcars)

pred <- predictions(mod, variables = c("cyl", "am", "gear"))
pred
```

```{r}

variables <- c("cyl", "am", "gear")
tmp <- pred[, c(variables, c("predicted", "std.error"))]

get_one_variable <- function(v) {

    

aggregate(cbind(predicted, std.error) ~ cyl, data = tmp, FUN = mean)

tmp <- reshape(tmp, 
               direction = "long", 
               varying = c("predicted", "std.error"),
               v.names = "statistic")
head(tmp)



